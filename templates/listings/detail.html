{% extends "anyAuthenticationLayout.html" %}

{% block title %}Detalles de arriendo{% endblock %}

{% block content %}
<h2>{{ object.location_text }}</h2>
<p><b>Precio:</b> ${{ object.price }}</p>
<p><b>Zona:</b> {{ object.zone.name }} - {{ object.zone.city }}</p>
<p><b>Número de habitaciones:</b> {{ object.rooms }}</p>
<p><b>Baños:</b> {{ object.bathrooms }}</p>
<p><b>Precio de servicios:</b> ${{ object.utilities_price }}</p>
<p><b>Disponible:</b> {{ object.available|yesno:"Sí,No" }}</p>
<p><b>Visitas:</b> {{ object.views }}</p>
<p><b>Popularidad:</b> {{ object.popularity }}</p>

{% if can_add_favorite or can_remove_favorite %}
    <hr>
    <p><b>Favoritos:</b> {{ favorited_by }}</p>
    {% if can_add_favorite %}
        <form action="{% url 'listings:addFavorite' object.pk %}" method="post">
            {% csrf_token %}
            <button type="submit">Añadir a Favoritos</button>
        </form>
    {% elif can_remove_favorite %}
        <form action="{% url 'listings:removeFavorite' object.pk %}" method="post">
            {% csrf_token %}
            <button type="submit">Quitar de Favoritos</button>
        </form>
    {% endif %}
{% endif %}
<hr>

<h3>Comentarios</h3>

<ul>
  {% for comment in comments %}
    <li style="margin-bottom: 0.75rem;">
      <strong>
        {{ comment.author.get_full_name|default:comment.author.username }}
      </strong><br>
      <small>{{ comment.created_at|date:"d/m/Y H:i" }}</small><br>
      {{ comment.text|linebreaks }}
      {% if user.is_authenticated and comment.author_id == user.id %}
        <form action="{% url 'listings:comment_delete' comment.pk %}" method="post">
          {% csrf_token %}
          <button type="submit">Eliminar</button>
        </form>
      {% endif %}
  {% empty %}
    <p>No hay comentarios todavía.</p>
  {% endfor %}
</ul>

<hr>
{% if can_comment %}
  <h4>Agregar comentario</h4>
  <form action="{% url 'listings:comment_create' object.pk %}" method="post">
    {% csrf_token %}
    {{ comment_form.text.errors }}
    {{ comment_form.text }}
    <br>
    <button type="submit">Enviar</button>
  </form>
{% else %}
  <p>
    Debes iniciar sesión como estudiante o ser el arrendador dueño del anuncio
    para poder comentar.
  </p>
{% endif %}

<br>

<h3>Reseñas</h3>

<ul>
  {% for review in reviews %}
    <li style="margin-bottom: 0.75rem;">
      <strong>
        {{ review.author.user.get_full_name|default:review.author.user.username }}
      </strong><br>
      <small>{{ review.created_at|date:"d/m/Y H:i" }}</small><br>
      {{ review.rating }}
      {{ review.text|linebreaks }}

      {% if user.is_authenticated and review.author.user.id == user.id %}
        <form action="{% url 'listings:review_delete' review.pk %}" method="post">
          {% csrf_token %}
          <button type="submit">Eliminar</button>
        </form>
      {% endif %}
  {% empty %}
    <p>No hay reseñas todavía.</p>
  {% endfor %}
</ul>

<hr>
{% if can_review %}
  <h4>Dejar reseña</h4>
  <form action="{% url 'listings:review_create' object.pk %}" method="post">
    {% csrf_token %}
    {{ review_form.text.errors }}
    {{ review_form.text }}
    {{ review_form.rating }}
    <br>
    <button type="submit">Enviar</button>
  </form>
{% else %}
  <p>
    Debes iniciar sesión como estudiante y no haber dejado una reseña en esta publicación antes para poder dejar una reseña.
  </p>
{% endif %}

<br>
<a href="{% url 'listings:listing_public_list' %}">Regresar a arriendos</a>

{% endblock %}
