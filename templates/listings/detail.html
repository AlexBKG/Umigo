{% extends "anyAuthenticationLayout.html" %}

{% block title %}Detalles de arriendo{% endblock %}

{% block content %}
<h2>{{ object.location_text }}</h2>
<p><b>Precio:</b> ${{ object.price }}</p>
<p><b>Zona:</b> {{ object.zone.name }} - {{ object.zone.city }}</p>
<p><b>Cuartos:</b> {{ object.rooms }}</p>
<p><b>Baños:</b> {{ object.bathrooms }}</p>
<p><b>Precio de servicios:</b> ${{ object.utilities_price }}</p>
<p><b>Disponible:</b> {{ object.available|yesno:"Si,No" }}</p>
<p><b>Vistas:</b> {{ object.views }}</p>

{% if object.photos.all %}
    <h3>Fotos del arriendo</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for photo in object.photos.all %}
            <div>
                <img src="{{ photo.image.url }}"
                     alt="Foto {{ forloop.counter }} de {{ object.location_text }}"
                     style="max-width: 250px; height: auto; border: 1px solid #ccc;">
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>Este arriendo todavía no tiene fotos.</p>
{% endif %}

<hr>
<h3>Comentarios</h3>

<ul>
  {% for comment in comments %}
    <li style="margin-bottom: 0.75rem;">
      <strong>
        {{ comment.author.get_full_name|default:comment.author.username }}
      </strong><br>
      <small>{{ comment.created_at|date:"d/m/Y H:i" }}</small><br>
      {{ comment.text|linebreaks }}
      {% if user.is_authenticated and comment.author_id == user.id %}
        <form action="{% url 'listings:comment_delete' comment.pk %}" method="post">
          {% csrf_token %}
          <button type="submit">Eliminar</button>
        </form>
      {% endif %}
  {% empty %}
    <p>No hay comentarios todavía.</p>
  {% endfor %}
</ul>

<hr>
{% if can_comment %}
  <h4>Agregar comentario</h4>
  <form action="{% url 'listings:comment_create' object.pk %}" method="post">
    {% csrf_token %}
    {{ comment_form.text.errors }}
    {{ comment_form.text }}
    <br>
    <button type="submit">Enviar</button>
  </form>
{% else %}
  <p>
    Debes iniciar sesión como estudiante o ser el arrendador dueño del anuncio
    para poder comentar.
  </p>
{% endif %}

<br>
<a href="{% url 'listings:listing_public_list' %}">Regresar a arriendos</a>
{% endblock %}
